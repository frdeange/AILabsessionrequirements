{% extends 'base.html' %}
{% block title %}Azure AI Provisioner · Home{% endblock %}
{% block content %}
<section class="hero">
  <div class="hero-head">
  <h2>Provision Azure AI Building Blocks Faster</h2>
  <p class="tagline">One-click ephemeral environment: Resource Group, Azure AI Services, Foundry Hub + Project, Storage Account, optional Azure AI Search.</p>
  </div>
  <div class="grid cols-2">
    <div class="card">
      <h2>Deployment Form</h2>
      {% if error %}<div class="error-box">{{ error }}</div>{% endif %}
      <form class="provision-form" action="/deploy" method="post">
        <div>
          <label>Resource Group Base (3-15 chars)</label>
          <input name="resource_group_base" type="text" required maxlength="15" minlength="3" placeholder="demoai" />
        </div>
        <div>
          <label>Region Group</label>
          <select id="region_group">
            <option value="EMEA" selected>EMEA</option>
            <option value="AMERICAS">AMERICAS</option>
            <option value="ASIA">ASIA</option>
          </select>
        </div>
        <div>
          <label>Location</label>
          <select name="location" id="location_select"></select>
        </div>
  <!-- Model deployment inputs simplificados: usamos defaults sin pedir versión, nombre lógico ni SKU -->
        <div>
          <label>Model Name</label>
          <select name="openai_model_name">
            <option value="gpt-4.1" selected>gpt-4.1</option>
            <option value="gpt-4.1-mini">gpt-4.1-mini</option>
            <option value="gpt-4o">gpt-4o</option>
            <option value="gpt-4o-mini">gpt-4o-mini</option>
          </select>
        </div>
        <div>
          <label>Subscription ID (optional)</label>
          <input name="subscription_id" type="text" placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" />
        </div>
        <div class="checkbox-inline">
          <input type="checkbox" id="include_search" name="include_search" value="1" checked/>  
          <label for="include_search" style="margin:0; text-transform:none; letter-spacing:normal; font-size:.85rem; font-weight:500; color:var(--text);">Include Azure AI Search</label>
        </div>
        <div>
          <button class="primary" type="submit">Deploy Environment</button>
        </div>
  <p class="notice form-note-span">Terraform & Azure CLI must be available inside this container. If you leave Subscription ID empty the app will try <code>AZ_SUBSCRIPTION_ID</code> env var.</p>
      </form>
    </div>
    <div class="card">
      <h2>What This Tool Does</h2>
      <div class="description">
        <p>This lightweight UI orchestrates <strong>infrastructure provisioning</strong> for Azure AI enablement workshops or rapid PoCs. It automates consistent naming, executes Terraform to stand up required services, then enriches outputs by fetching access keys via Azure CLI.</p>
        <ul class="inline-list" style="margin:.8rem 0 1rem;">
          <li>Resource Group</li><li>AI Services</li><li>Foundry Hub & Project</li><li>Storage Account</li><li>Key Vault</li><li>Optional Search</li>
        </ul>
        <p><strong>Ephemeral by design:</strong> you can destroy resources afterwards with <code>terraform destroy</code> or deleting the Resource Group.</p>
        <p><strong>Security note:</strong> Secret values appear in the results table for convenience only; rotate or store them securely before sharing.</p>
        <p><strong>DRY-RUN mode:</strong> Set <code>DRY_RUN=1</code> environment variable to simulate a deployment without touching Azure (for UI demos).</p>
      </div>
    </div>
  </div>
</section>
{% endblock %}
{% block body_end %}
<script>
  const REGIONS = {
    EMEA: ["francecentral","germanywestcentral","northeurope","swedencentral","switzerlandnorth","uksouth","westeurope"],
    AMERICAS: ["eastus","eastus2","southcentralus","westus","westus3","canadacentral"],
    ASIA: ["australiaeast","japaneast","koreacentral","southeastasia","centralindia"]
  };
  const groupSel = document.getElementById('region_group');
  const locSel = document.getElementById('location_select');
  function populate() {
    const g = groupSel.value;
    locSel.innerHTML = '';
    REGIONS[g].forEach(r => {
      const opt = document.createElement('option');
      opt.value = r; opt.textContent = r; locSel.appendChild(opt);
    });
  }
  groupSel.addEventListener('change', populate);
  populate();
</script>
{% endblock %}
